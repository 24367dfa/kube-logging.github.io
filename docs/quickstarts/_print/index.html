<!doctype html><html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="generator" content="Hugo 0.110.0">
<link rel="canonical" type="text/html" href="https://kube-logging.dev/docs/quickstarts/">
<link rel="alternate" type="text/releases" href="https://kube-logging.dev/docs/quickstarts/releases.releases">
<meta name="robots" content="noindex, nofollow">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">
<title>Quick start guides | Logging operator</title><meta name="description" content="Documentation for the Logging operator">
<meta property="og:title" content="Quick start guides">
<meta property="og:description" content="Documentation for the Logging operator">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kube-logging.dev/docs/quickstarts/"><meta property="og:site_name" content="Logging operator">
<meta itemprop="name" content="Quick start guides">
<meta itemprop="description" content="Documentation for the Logging operator"><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Quick start guides">
<meta name="twitter:description" content="Documentation for the Logging operator">
<meta name="twitter:site" content="@calisti12">
<link rel="preload" href="/scss/main.min.8fe0c90ad7309be91f08b53a0b21f58fb6fb3ec600e7e4523cb047239e3c27a3.css" as="style">
<link href="/scss/main.min.8fe0c90ad7309be91f08b53a0b21f58fb6fb3ec600e7e4523cb047239e3c27a3.css" rel="stylesheet" integrity>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/w3.js" type="application/x-javascript"></script>
<link rel="canonical" href="https://kube-logging.dev/docs/quickstarts/">
<script src="/pagefind/pagefind-ui.js" type="application/x-javascript"></script>
<script>window.addEventListener("DOMContentLoaded",e=>{new PagefindUI({element:"#search",resetStyles:!1})})</script>
</head><body class="td-section">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 3237.738 490.023" id="svg142" sodipodi:docname="logo-new2.svg" inkscape:version="1.2.1 (9c6d41e4, 2022-07-14)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs146"/><sodipodi:namedview id="namedview144" pagecolor="#505050" bordercolor="#ffffff" borderopacity="1" inkscape:showpageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="1" inkscape:deskcolor="#505050" showgrid="false" inkscape:zoom=".37340884" inkscape:cx="1620.208" inkscape:cy="243.70071" inkscape:window-width="705" inkscape:window-height="480" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="svg142"/><g id="Group_2068" data-name="Group 2068" transform="translate(-43577.297 -34456.625)"><g id="Group_2067" data-name="Group 2067" transform="translate(27723.789 24565.273)"><path id="Path_4217" data-name="Path 4217" d="M47842.219 34024.414l-276.027 475.07h71.242l240.227-414.1z" transform="translate(-31703.996 -24123.111)" fill="#d6d7d9" stroke="#d6d7d9" stroke-width="10"/><path id="Path_4218" data-name="Path 4218" d="M47831.324 34080.781l166.754 287.355h-333.035z" transform="translate(-31640.254 -24086.76)" fill="#fff" stroke="#fff" stroke-width="10"/><path id="Path_4220" data-name="Path 4220" d="M47668.742 34274.2l-37.727 64.1h442.43l-37.156-64.1z" transform="translate(-31662.199 -23962.018)" fill="#d6d7d9" stroke="#d6d7d9" stroke-width="10"/><path id="Path_4222" data-name="Path 4222" d="M11294.989 10157.944l311.97-.01-156.218-269.074-78.621 135.83z" transform="translate(4740.338 117.39)" fill="#fff"/><path id="Path_4224" data-name="Path 4224" d="M47787.594 34159.125l-54.391 93.035h108.039z" transform="translate(-31596.297 -24036.238)" fill="#13142c" stroke="#13132d" stroke-width="10"/></g><text id="Logging_Operator" data-name="Logging Operator" transform="translate(45475.035 34799.609)" fill="#fff" font-size="267" font-family="Montserrat-Bold, Montserrat" font-weight="700" letter-spacing=".046em"><tspan x="-1339.806" y="0" id="tspan138">Logging Operator</tspan></text></g></svg></span><span class="navbar-brand__name">Logging operator</span>
<span class="font-weight-bold navbar-logo navbar-version">4.3.0</span></a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="https://github.com/kube-logging/logging-operator" target="_blank"><span>Project page</span></a>
</li><li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link" href="/docs/"><span>Documentation</span></a>
</li><li class="nav-item dropdown mr-4 d-none d-lg-block">
<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
<div w3-include-html="/docs/quickstarts//releases.releases" w3-include-html-default='<a class="dropdown-item" href="/docs/releases.releases">Latest</a>'></div><script type="application/x-javascript">w3.includeHTML()</script>
</div></li></ul></div><div class="navbar-nav d-none d-lg-block">
</div></nav></header><div class="container-fluid td-outer">
<div class="td-main">
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href="/docs/quickstarts/">Return to the regular view of this page</a>.
</p></div><h1 class="title">Quick start guides</h1><ul>
<li>1: <a href="#pg-865e01bcfff2e24f1199d4db36dd9698">Transport all logs into Amazon S3 with Logging operator</a></li><li>2: <a href="#pg-56c76849d22b613f42710b86805db107">Store NGINX access logs in Elasticsearch with Logging operator</a></li><li>3: <a href="#pg-04688fbf5b514152de232c6d6f6eaebf">Sumo Logic with Logging operator and syslog-ng</a></li></ul><div class="content">
<p>Try out Logging Operator with these quick start guides!</p></div></div><div class="td-content">
<h1 id="pg-865e01bcfff2e24f1199d4db36dd9698">1 - Transport all logs into Amazon S3 with Logging operator</h1><p align="center"><img src="../../img/s3_logo.png" alt="Logos" width="340"></p><p>This guide describes how to collect all the container logs in Kubernetes using the Logging operator, and how to send them to Amazon S3.</p><p>The following figure gives you an overview about how the system works. The Logging operator collects the logs from the application, selects which logs to forward to the output, and sends the selected log messages to the output. For more details about the Logging operator, see the <a href="/docs/">Logging operator overview</a>.</p><p align="center"><img src="../../img/s3_flow.png" alt="Architecture" width="900"></p><h2 id="deploy-the-logging-operator">Deploy the Logging operator</h2><p>Install the Logging operator.</p><h3 id="helm">Deploy the Logging operator with Helm</h3><p>To install the Logging operator using Helm, complete these steps.</p><blockquote>
<p>Note: You need Helm v3.8 or later to be able to install the chart from an OCI registry.</p></blockquote><ol>
<li>
<p>Install the Logging operator into the <em>logging</em> namespace:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging logging-operator oci://ghcr.io/kube-logging/helm-charts/logging-operator
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Release <span style="color:#4e9a06">&#34;logging-operator&#34;</span> does not exist. Installing it now.
</span></span><span style="display:flex"><span>Pulled: ghcr.io/kube-logging/helm-charts/logging-operator:4.3.0
</span></span><span style="display:flex"><span>Digest: sha256:c2ece861f66a3a2cb9788e7ca39a267898bb5629dc98429daa8f88d7acf76840
</span></span><span style="display:flex"><span>NAME: logging-operator
</span></span><span style="display:flex"><span>LAST DEPLOYED: Wed Aug  <span style="color:#0000cf;font-weight:700">9</span> 11:02:12 <span style="color:#0000cf;font-weight:700">2023</span>
</span></span><span style="display:flex"><span>NAMESPACE: logging
</span></span><span style="display:flex"><span>STATUS: deployed
</span></span><span style="display:flex"><span>REVISION: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span>TEST SUITE: None
</span></span></code></pre></div></li><li>
<p><a href="#validate">Validate your deployment</a>.</p></li></ol><h2 id="configure-the-logging-operator">Configure the Logging operator</h2><ol>
<li>
<p>Create AWS <code>secret</code></p><blockquote>
<p>If you have your <code>$AWS_ACCESS_KEY_ID</code> and <code>$AWS_SECRET_ACCESS_KEY</code> set you can use the following snippet.</p></blockquote><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging create secret generic logging-s3 --from-literal <span style="color:#4e9a06">&#34;awsAccessKeyId=</span><span style="color:#000">$AWS_ACCESS_KEY_ID</span><span style="color:#4e9a06">&#34;</span> --from-literal <span style="color:#4e9a06">&#34;awsSecretAccessKey=</span><span style="color:#000">$AWS_SECRET_ACCESS_KEY</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Or set up the secret manually.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>    kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>    apiVersion: v1
</span></span><span style="display:flex"><span>    kind: Secret
</span></span><span style="display:flex"><span>    metadata:
</span></span><span style="display:flex"><span>      name: logging-s3
</span></span><span style="display:flex"><span>    type: Opaque
</span></span><span style="display:flex"><span>    data:
</span></span><span style="display:flex"><span>      awsAccessKeyId: &lt;base64encoded&gt;
</span></span><span style="display:flex"><span>      awsSecretAccessKey: &lt;base64encoded&gt;
</span></span><span style="display:flex"><span>    EOF
</span></span></code></pre></div></li><li>
<p>Create the <code>logging</code> resource.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Logging
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: default-logging-simple
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  fluentd: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>  fluentbit: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>  controlNamespace: logging
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: You can use the <code>ClusterOutput</code> and <code>ClusterFlow</code> resources only in the <code>controlNamespace</code>.</p></blockquote></li><li>
<p>Create an S3 <code>output</code> definition.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Output
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span> name: s3-output
</span></span><span style="display:flex"><span> namespace: logging
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span> s3:
</span></span><span style="display:flex"><span>   aws_key_id:
</span></span><span style="display:flex"><span>     valueFrom:
</span></span><span style="display:flex"><span>       secretKeyRef:
</span></span><span style="display:flex"><span>         name: logging-s3
</span></span><span style="display:flex"><span>         key: awsAccessKeyId
</span></span><span style="display:flex"><span>   aws_sec_key:
</span></span><span style="display:flex"><span>     valueFrom:
</span></span><span style="display:flex"><span>       secretKeyRef:
</span></span><span style="display:flex"><span>         name: logging-s3
</span></span><span style="display:flex"><span>         key: awsSecretAccessKey
</span></span><span style="display:flex"><span>   s3_bucket: logging-amazon-s3
</span></span><span style="display:flex"><span>   s3_region: eu-central-1
</span></span><span style="display:flex"><span>   path: logs/<span style="color:#4e9a06">${</span><span style="color:#000">tag</span><span style="color:#4e9a06">}</span>/%Y/%m/%d/
</span></span><span style="display:flex"><span>   buffer:
</span></span><span style="display:flex"><span>     timekey: 10m
</span></span><span style="display:flex"><span>     timekey_wait: 30s
</span></span><span style="display:flex"><span>     timekey_use_utc: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: In production environment, use a longer <code>timekey</code> interval to avoid generating too many objects.</p></blockquote></li><li>
<p>Create a <code>flow</code> resource. (Mind the label selector in the <code>match</code> that selects a set of pods that we will install in the next step)</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Flow
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: s3-flow
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  filters:
</span></span><span style="display:flex"><span>    - tag_normaliser: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>  match:
</span></span><span style="display:flex"><span>    - <span style="color:#204a87;font-weight:700">select</span>:
</span></span><span style="display:flex"><span>        labels:
</span></span><span style="display:flex"><span>          app.kubernetes.io/name: log-generator
</span></span><span style="display:flex"><span>  localOutputRefs:
</span></span><span style="display:flex"><span>    - s3-output
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div></li><li>
<p>Install log-generator to produce logs with the label <code>app.kubernetes.io/name: log-generator</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging log-generator oci://ghcr.io/kube-logging/helm-charts/log-generator
</span></span></code></pre></div></li><li>
<p><a href="#validate">Validate your deployment</a>.</p></li></ol><h2 id="validate">Validate the deployment</h2><p>Check fluentd logs (errors with AWS credentials should be visible here):</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl <span style="color:#204a87">exec</span> -ti -n logging default-logging-simple-fluentd-0 -- tail -f /fluentd/log/out
</span></span></code></pre></div><p>Check the output. The logs will be available in the bucket on a <code>path</code> like:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>/logs/default.default-logging-simple-fluentbit-lsdp5.fluent-bit/2019/09/11/201909111432_0.gz
</span></span></code></pre></div><blockquote>
<p>If you don&rsquo;t get the expected result you can find help in the <a href="/docs/operation/troubleshooting/">troubleshooting section</a>.</p></blockquote></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-56c76849d22b613f42710b86805db107">2 - Store NGINX access logs in Elasticsearch with Logging operator</h1><p align="center"><img src="../../img/nle.png" alt="Logos" width="340"></p><p>This guide describes how to collect application and container logs in Kubernetes using the Logging operator, and how to send them to Elasticsearch.</p><p>The following figure gives you an overview about how the system works. The Logging operator collects the logs from the application, selects which logs to forward to the output, and sends the selected log messages to the output. For more details about the Logging operator, see the <a href="/docs/">Logging operator overview</a>.</p><p align="center"><img src="../../img/nginx-elastic.png" alt="Architecture" width="900"></p><h2 id="deploy-elasticsearch">Deploy Elasticsearch</h2><p>First, deploy Elasticsearch in your Kubernetes cluster. The following procedure is based on the <a href="https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-quickstart.html">Elastic Cloud on Kubernetes quickstart</a>, but there are some minor configuration changes, and we install everything into the <em>logging</em> namespace.</p><ol>
<li>
<p>Install the Elasticsearch operator.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#000">kubectl apply -f https://download.elastic.co/downloads/eck/1.3.0/all-in-one.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>Create the <code>logging</code> Namespace.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl create ns logging
</span></span></code></pre></div></li><li>
<p>Install the Elasticsearch cluster into the <em>logging</em> namespace.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#000">cat &lt;&lt;EOF | kubectl apply -n logging -f -</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">elasticsearch.k8s.elastic.co/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Elasticsearch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">quickstart</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">version</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">7.10.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">nodeSets</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">count</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">config</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">node.master</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">node.data</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">node.ingest</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:700">node.store.allow_mmap</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:700">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">EOF</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li><li>
<p>Install Kibana into the <em>logging</em> namespace.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#000">cat &lt;&lt;EOF | kubectl apply -n logging -f -</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">apiVersion</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kibana.k8s.elastic.co/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">kind</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Kibana</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">metadata</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">quickstart</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:700">spec</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">version</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">7.10.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">count</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:700">elasticsearchRef</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:700">name</span><span style="color:#000;font-weight:700">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">quickstart</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">EOF</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></li></ol><h2 id="deploy-the-logging-operator-and-a-demo-application">Deploy the Logging operator and a demo Application</h2><p>Install the Logging operator and a demo application to provide sample log messages.</p><h3 id="helm">Deploy the Logging operator with Helm</h3><p>To install the Logging operator using Helm, complete these steps.</p><blockquote>
<p>Note: You need Helm v3.8 or later to be able to install the chart from an OCI registry.</p></blockquote><ol>
<li>
<p>Install the Logging operator into the <em>logging</em> namespace:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging logging-operator oci://ghcr.io/kube-logging/helm-charts/logging-operator
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Release <span style="color:#4e9a06">&#34;logging-operator&#34;</span> does not exist. Installing it now.
</span></span><span style="display:flex"><span>Pulled: ghcr.io/kube-logging/helm-charts/logging-operator:4.3.0
</span></span><span style="display:flex"><span>Digest: sha256:c2ece861f66a3a2cb9788e7ca39a267898bb5629dc98429daa8f88d7acf76840
</span></span><span style="display:flex"><span>NAME: logging-operator
</span></span><span style="display:flex"><span>LAST DEPLOYED: Wed Aug  <span style="color:#0000cf;font-weight:700">9</span> 11:02:12 <span style="color:#0000cf;font-weight:700">2023</span>
</span></span><span style="display:flex"><span>NAMESPACE: logging
</span></span><span style="display:flex"><span>STATUS: deployed
</span></span><span style="display:flex"><span>REVISION: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span>TEST SUITE: None
</span></span></code></pre></div></li><li>
<p><a href="#validate">Validate your deployment</a>.</p></li></ol><h2 id="configure-the-logging-operator">Configure the Logging operator</h2><ol>
<li>
<p>Create the <code>logging</code> resource.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Logging
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: default-logging-simple
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  fluentd: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>  fluentbit: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>  controlNamespace: logging
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: You can use the <code>ClusterOutput</code> and <code>ClusterFlow</code> resources only in the <code>controlNamespace</code>.</p></blockquote></li><li>
<p>Create an Elasticsearch <code>output</code> definition.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Output
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: es-output
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  elasticsearch:
</span></span><span style="display:flex"><span>    host: quickstart-es-http.logging.svc.cluster.local
</span></span><span style="display:flex"><span>    port: <span style="color:#0000cf;font-weight:700">9200</span>
</span></span><span style="display:flex"><span>    scheme: https
</span></span><span style="display:flex"><span>    ssl_verify: <span style="color:#204a87">false</span>
</span></span><span style="display:flex"><span>    ssl_version: TLSv1_2
</span></span><span style="display:flex"><span>    user: elastic
</span></span><span style="display:flex"><span>    password:
</span></span><span style="display:flex"><span>      valueFrom:
</span></span><span style="display:flex"><span>        secretKeyRef:
</span></span><span style="display:flex"><span>          name: quickstart-es-elastic-user
</span></span><span style="display:flex"><span>          key: elastic
</span></span><span style="display:flex"><span>    buffer:
</span></span><span style="display:flex"><span>      timekey: 1m
</span></span><span style="display:flex"><span>      timekey_wait: 30s
</span></span><span style="display:flex"><span>      timekey_use_utc: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: In production environment, use a longer <code>timekey</code> interval to avoid generating too many objects.</p></blockquote></li><li>
<p>Create a <code>flow</code> resource. (Mind the label selector in the <code>match</code> that selects a set of pods that we will install in the next step)</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Flow
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: es-flow
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  filters:
</span></span><span style="display:flex"><span>    - tag_normaliser: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>    - parser:
</span></span><span style="display:flex"><span>        remove_key_name_field: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>        reserve_data: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>        parse:
</span></span><span style="display:flex"><span>          type: nginx
</span></span><span style="display:flex"><span>  match:
</span></span><span style="display:flex"><span>     - <span style="color:#204a87;font-weight:700">select</span>:
</span></span><span style="display:flex"><span>         labels:
</span></span><span style="display:flex"><span>           app.kubernetes.io/name: log-generator
</span></span><span style="display:flex"><span>  localOutputRefs:
</span></span><span style="display:flex"><span>    - es-output
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div></li><li>
<p>Install the demo application.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging log-generator oci://ghcr.io/kube-logging/helm-charts/log-generator
</span></span></code></pre></div></li><li>
<p><a href="#validate">Validate your deployment</a>.</p></li></ol><h2 id="validate">Validate the deployment</h2><p>To validate that the deployment was successful, complete the following steps.</p><ol>
<li>
<p>Check fluentd logs:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl <span style="color:#204a87">exec</span> -ti -n logging default-logging-simple-fluentd-0 -- tail -f /fluentd/log/out
</span></span></code></pre></div></li><li>
<p>Use the following command to retrieve the password of the <code>elastic</code> user:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging get secret quickstart-es-elastic-user -o<span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#4e9a06">&#39;{.data.elastic}&#39;</span> <span style="color:#000;font-weight:700">|</span> base64 --decode<span style="color:#000;font-weight:700">;</span> <span style="color:#204a87">echo</span>
</span></span></code></pre></div></li><li>
<p>Enable port forwarding to the Kibana Dashboard Service.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging port-forward svc/quickstart-kb-http <span style="color:#0000cf;font-weight:700">5601</span>
</span></span></code></pre></div></li><li>
<p>Open the Kibana dashboard in your browser at <a href="https://localhost:5601">https://localhost:5601</a> and login as <strong>elastic</strong> using the retrieved password.</p></li><li>
<p>By default, the Logging operator sends the incoming log messages into an index called <em>fluentd</em>. Create an Index Pattern that includes this index (for example, <em>fluentd*</em>), then select <strong>Menu > Kibana > Discover</strong>. You should see the dashboard and some sample log messages from the demo application.</p></li></ol><p align="center"><img src="../../img/es_kibana.png" alt="Kibana dashboard"></p><blockquote>
<p>If you don&rsquo;t get the expected result you can find help in the <a href="/docs/operation/troubleshooting/">troubleshooting section</a>.</p></blockquote></div><div class="td-content" style="page-break-before:always">
<h1 id="pg-04688fbf5b514152de232c6d6f6eaebf">3 - Sumo Logic with Logging operator and syslog-ng</h1><p>This guide helps you install and configure the Logging operator and syslog-ng to forward logs to your Sumo Logic account.</p><h2 id="prerequisites">Prerequisites</h2><p>We assume that you already have:</p><ul>
<li>
<p>A Sumo Logic account.</p></li><li>
<p>A <a href="https://help.sumologic.com/03Send-Data/Sources/02Sources-for-Hosted-Collectors/HTTP-Source">HTTP Hosted Collector</a> configured in the Sumo Logic service.</p><p>To configure a Hosted Collector, complete the steps in the <a href="https://help.sumologic.com/03Send-Data/Hosted-Collectors/Configure-a-Hosted-Collector">Configure a Hosted Collector</a> section on the official Sumo Logic website.</p></li><li>
<p>The unique HTTP collector code you receive while configuring your Host Collector for HTTP requests.</p></li></ul><hr>
<h2 id="deploy-the-logging-operator-and-a-demo-application">Deploy the Logging operator and a demo Application</h2><p>Install the Logging operator and a demo application to provide sample log messages.</p><h3 id="helm">Deploy the Logging operator with Helm</h3><p>To install the Logging operator using Helm, complete these steps.</p><blockquote>
<p>Note: You need Helm v3.8 or later to be able to install the chart from an OCI registry.</p></blockquote><ol>
<li>
<p>Install the Logging operator into the <em>logging</em> namespace:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging logging-operator oci://ghcr.io/kube-logging/helm-charts/logging-operator
</span></span></code></pre></div><p>Expected output:</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="display:flex"><span>Release <span style="color:#4e9a06">&#34;logging-operator&#34;</span> does not exist. Installing it now.
</span></span><span style="display:flex"><span>Pulled: ghcr.io/kube-logging/helm-charts/logging-operator:4.3.0
</span></span><span style="display:flex"><span>Digest: sha256:c2ece861f66a3a2cb9788e7ca39a267898bb5629dc98429daa8f88d7acf76840
</span></span><span style="display:flex"><span>NAME: logging-operator
</span></span><span style="display:flex"><span>LAST DEPLOYED: Wed Aug  <span style="color:#0000cf;font-weight:700">9</span> 11:02:12 <span style="color:#0000cf;font-weight:700">2023</span>
</span></span><span style="display:flex"><span>NAMESPACE: logging
</span></span><span style="display:flex"><span>STATUS: deployed
</span></span><span style="display:flex"><span>REVISION: <span style="color:#0000cf;font-weight:700">1</span>
</span></span><span style="display:flex"><span>TEST SUITE: None
</span></span></code></pre></div></li></ol><h2 id="configure-the-logging-operator">Configure the Logging operator</h2><ol>
<li>
<p>Create the <code>logging</code> resource with a persistent syslog-ng installation.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: Logging
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: demo
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  controlNamespace: logging
</span></span><span style="display:flex"><span>  fluentbit: <span style="color:#ce5c00;font-weight:700">{}</span>
</span></span><span style="display:flex"><span>  syslogNG:
</span></span><span style="display:flex"><span>    statefulSet:
</span></span><span style="display:flex"><span>      spec:
</span></span><span style="display:flex"><span>        template:
</span></span><span style="display:flex"><span>          spec:
</span></span><span style="display:flex"><span>            containers:
</span></span><span style="display:flex"><span>            - name: syslog-ng
</span></span><span style="display:flex"><span>              volumeMounts:
</span></span><span style="display:flex"><span>              - mountPath: /buffers
</span></span><span style="display:flex"><span>                name: buffer
</span></span><span style="display:flex"><span>        volumeClaimTemplates:
</span></span><span style="display:flex"><span>        - metadata:
</span></span><span style="display:flex"><span>            name: buffer
</span></span><span style="display:flex"><span>          spec:
</span></span><span style="display:flex"><span>            accessModes:
</span></span><span style="display:flex"><span>            - ReadWriteOnce
</span></span><span style="display:flex"><span>            resources:
</span></span><span style="display:flex"><span>              requests:
</span></span><span style="display:flex"><span>                storage: 10Gi
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div><blockquote>
<p>Note: You can use the <code>ClusterOutput</code> and <code>ClusterFlow</code> resources only in the <code>controlNamespace</code>.</p></blockquote></li><li>
<p>Create a Sumo Logic output secret from the URL of your Sumo Logic collection.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl create secret generic sumo-collector -n logging --from-literal <span style="color:#4e9a06">&#34;token=XYZ&#34;</span>
</span></span></code></pre></div></li><li>
<p>Create a <code>SyslogNGOutput</code> resource.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: SyslogNGOutput
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: sumologic-syslog-ng-output
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  sumologic-http: 
</span></span><span style="display:flex"><span>    collector:
</span></span><span style="display:flex"><span>      valueFrom:
</span></span><span style="display:flex"><span>        secretKeyRef:
</span></span><span style="display:flex"><span>          key: token
</span></span><span style="display:flex"><span>          name: sumo-collector
</span></span><span style="display:flex"><span>    deployment: us2
</span></span><span style="display:flex"><span>    batch-lines: <span style="color:#0000cf;font-weight:700">1000</span>
</span></span><span style="display:flex"><span>    disk_buffer:
</span></span><span style="display:flex"><span>      disk_buf_size: <span style="color:#0000cf;font-weight:700">512000000</span>
</span></span><span style="display:flex"><span>      dir: /buffers
</span></span><span style="display:flex"><span>      reliable: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>    body: <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:700">$(</span>format-json --subkeys json. --exclude json.kubernetes.annotations.* json.kubernetes.annotations<span style="color:#ce5c00;font-weight:700">=</span>literal<span style="color:#ce5c00;font-weight:700">(</span><span style="color:#204a87;font-weight:700">$(</span>format-flat-json --subkeys json.kubernetes.annotations.<span style="color:#204a87;font-weight:700">))</span><span style="color:#4e9a06"> --exclude json.kubernetes.labels.* json.kubernetes.labels=literal(</span><span style="color:#204a87;font-weight:700">$(</span>format-flat-json --subkeys json.kubernetes.labels.<span style="color:#204a87;font-weight:700">)</span><span style="color:#4e9a06">))&#34;</span>
</span></span><span style="display:flex"><span>    headers:
</span></span><span style="display:flex"><span>      - <span style="color:#4e9a06">&#39;X-Sumo-Name: source-name&#39;</span>
</span></span><span style="display:flex"><span>      - <span style="color:#4e9a06">&#39;X-Sumo-Category: source-category&#39;</span>
</span></span><span style="display:flex"><span>    tls:
</span></span><span style="display:flex"><span>      use-system-cert-store: <span style="color:#204a87">true</span>
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div></li><li>
<p>Create a <code>SyslogNGFlow</code> resource.</p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>kubectl -n logging apply -f - &lt;&lt;<span style="color:#4e9a06">&#34;EOF&#34;</span>
</span></span><span style="display:flex"><span>apiVersion: logging.banzaicloud.io/v1beta1
</span></span><span style="display:flex"><span>kind: SyslogNGFlow
</span></span><span style="display:flex"><span>metadata:
</span></span><span style="display:flex"><span>  name: log-generator
</span></span><span style="display:flex"><span>spec:
</span></span><span style="display:flex"><span>  match:
</span></span><span style="display:flex"><span>    and:
</span></span><span style="display:flex"><span>    - regexp:
</span></span><span style="display:flex"><span>        value: json.kubernetes.labels.app.kubernetes.io/instance
</span></span><span style="display:flex"><span>        pattern: log-generator
</span></span><span style="display:flex"><span>        type: string
</span></span><span style="display:flex"><span>    - regexp:
</span></span><span style="display:flex"><span>        value:  json.kubernetes.labels.app.kubernetes.io/name
</span></span><span style="display:flex"><span>        pattern: log-generator
</span></span><span style="display:flex"><span>        type: string
</span></span><span style="display:flex"><span>  filters:
</span></span><span style="display:flex"><span>  -  parser:
</span></span><span style="display:flex"><span>      regexp: 
</span></span><span style="display:flex"><span>        patterns:
</span></span><span style="display:flex"><span>        - <span style="color:#4e9a06">&#39;^(?&lt;remote&gt;[^ ]*) (?&lt;host&gt;[^ ]*) (?&lt;user&gt;[^ ]*) \[(?&lt;time&gt;[^\]]*)\] &#34;(?&lt;method&gt;\S+)(?: +(?&lt;path&gt;[^\&#34;]*?)(?: +\S*)?)?&#34; (?&lt;code&gt;[^ ]*) (?&lt;size&gt;[^ ]*)(?: &#34;(?&lt;referer&gt;[^\&#34;]*)&#34; &#34;(?&lt;agent&gt;[^\&#34;]*)&#34;(?:\s+(?&lt;http_x_forwarded_for&gt;[^ ]+))?)?$&#39;</span>
</span></span><span style="display:flex"><span>        template: <span style="color:#4e9a06">${</span><span style="color:#000">json</span><span style="color:#000;font-weight:700">.message</span><span style="color:#4e9a06">}</span>
</span></span><span style="display:flex"><span>        prefix: json.
</span></span><span style="display:flex"><span>  - rewrite:
</span></span><span style="display:flex"><span>    -  set:
</span></span><span style="display:flex"><span>        field: json.cluster
</span></span><span style="display:flex"><span>        value: xxxxx
</span></span><span style="display:flex"><span>    -  unset:
</span></span><span style="display:flex"><span>        field: json.message
</span></span><span style="display:flex"><span>    -  set:
</span></span><span style="display:flex"><span>        field: json.source
</span></span><span style="display:flex"><span>        value: /var/log/log-generator
</span></span><span style="display:flex"><span>        condition:
</span></span><span style="display:flex"><span>          regexp:
</span></span><span style="display:flex"><span>            value:  json.kubernetes.container_name
</span></span><span style="display:flex"><span>            pattern: log-generator
</span></span><span style="display:flex"><span>            type: string
</span></span><span style="display:flex"><span>  localOutputRefs:
</span></span><span style="display:flex"><span>    - sumologic-syslog-ng-output
</span></span><span style="display:flex"><span>EOF
</span></span></code></pre></div></li><li>
<p>Install log-generator to produce logs with the label <code>app.kubernetes.io/name: log-generator</code></p><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>helm upgrade --install --wait --create-namespace --namespace logging log-generator oci://ghcr.io/kube-logging/helm-charts/log-generator
</span></span></code></pre></div></li></ol><blockquote>
<p>If you don&rsquo;t get the expected result you can find help in the <a href="/docs/operation/troubleshooting/">troubleshooting section</a>.</p></blockquote></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class="row">
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
<a class="text-white" target="_blank" rel="noopener" href="https://github.com/kube-logging/logging-operator" aria-label="GitHub">
<i class="fab fa-github"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
<a class="text-white" target="_blank" rel="noopener" href="https://banzaicloud.com/invite-slack/" aria-label="Slack">
<i class="fab fa-slack"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Discord" aria-label="Discord">
<a class="text-white" target="_blank" rel="noopener" href="https://discord.gg/9ACY4RDsYN" aria-label="Discord">
<i class="fab fa-discord"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class="text-white">&copy; 2023 kube-logging authors All Rights Reserved</small>
</div></div></div></footer></div><script src="/js/main.min.1b1fdad69306b68b100386e51fceb41fd37721de6a09b1df0495f948dfa59ee7.js" integrity="sha256-Gx/a1pMGtosQA4blH860H9N3Id5qCbHfBJX5SN+lnuc=" crossorigin="anonymous"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>
<script src="/js/tocbot.min.js"></script>
<script type="text/javascript">tocbot.init({tocSelector:".td-toc",contentSelector:".td-content",headingSelector:"h2, h3, h4",ignoreHiddenElements:!0})</script>
<script>(function(){var e=document.querySelector("#td-section-nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</body></html>